{% extends 'base.html' %}
{% from 'navbar.html' import navbar %}

{% set title = 'Startseite' %}

{% block navbar %}
  {{ navbar(processdata.active) }}
{% endblock %}


{% block style %}
  <style>
    .progress.vertical {
        position: relative;
        width: 20px;
        min-height: 240px;
        float: left;
        margin-right: 20px;
        background: none;
        -webkit-box-shadow: none;
        -moz-box-shadow: none;
        box-shadow: none;
        border: none;
    }
  </style>
{% endblock %}

{% block script %}
  <link rel="stylesheet" href="/static/jqwidgets/jqwidgets/styles/jqx.base.css" type="text/css" />
  <script type="text/javascript" src="/static/jqwidgets/jqwidgets/jqxcore.js"></script>
  <script type="text/javascript" src="/static/jqwidgets/jqwidgets/jqxchart.js"></script>
  <script type="text/javascript" src="/static/jqwidgets/jqwidgets/jqxgauge.js"></script>
  <script src="/static/plotly.min.js"></script>

  <script type="text/javascript">
    var data_x = [];
    var data_temp = [];

    $(document).ready(function() {
      // Socket data
      var socket = io.connect('http://' + document.domain + ':' + location.port);

      // gauge init
      $('#gauge').jqxLinearGauge({
          max: 100,
          min: 0,
          pointer: { size: '5%' },
          colorScheme: 'scheme03',
          ticksMajor: { size: '10%', interval: 10 },
          ticksMinor: { size: '5%', interval: 2.5, style: { 'stroke-width': 1, stroke: '#aaaaaa'} },
          value: 0,
          labels: { interval: 10, formatValue: function (value, position) {
            if (position === 'far') {
                return value;
            }
            else if (position === 'near') {
              if (value == 100) {
                  return '°C';
              }
            }
          },
          ranges: [
            {
              startValue: 0,
              endValue: 35,
              style: {fill: '#dddddd', stroke: '#dddddd'}
            },
            {
              startValue: 35,
              endValue: 55,
              style: {fill: '#FF4800', stroke: '#FF4800'}
            }
          ]
        }
      });

      // diagram init
      var graph = $('#graph').get(0);
      var graph_data = {{ graph_data | tojson }}
      data_x = graph_data.time;
      data_temp = graph_data.temp;

      Plotly.plot( graph, [{
        x: data_x,
        y: data_temp }], {
        margin: { t: 0 } }
      );

      // socket action
      socket.on('process_data', function(data) {
        data_x.push(data.time);
        data_temp.push(data.temp);
        Plotly.redraw(graph);

        $('#gauge').jqxLinearGauge('value', data.temp);
      });

    });
  </script>

{% endblock %}

{% block main %}
  <legend>{{ title }}</legend>

  <div class="row">
    <div class="col-md-10">
      <div class="panel panel-primary">
        <div class="panel-heading" data-toggle="collapse" data-target="#collapse-overview">
          <h4 class="panel-title">
            <a data-toggle="collapse" href="#collapse-overview">Überblick</a>
          </h4>
        </div>
        <div id="collapse-overview" class="panel-collapse collapse in">
          <div class="panel-body" id="panel-overview">
            <div class="col-md-offset-3 col-md-4">
              <img src="static/images/einkocher.jpg"/>
            </div>
            <div class="col-md-2">
              <div id="gauge"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-10">
      <div class="panel panel-primary">
        <div class="panel-heading" data-toggle="collapse" data-target="#collapse-graph">
          <h4 class="panel-title">
            <a data-toggle="collapse" href="#collapse-graph">Diagramm</a>
          </h4>
        </div>
        <div id="collapse-graph" class="panel-collapse collapse in">
          <div class="panel-body" id="panel-graph">
            <div id="graph">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

